package com.nju.edu.erp.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.cors.CorsConfiguration;
import org.springframework.web.cors.UrlBasedCorsConfigurationSource;
import org.springframework.web.filter.CorsFilter;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collections;
import java.util.List;

/**
 * @author: Leonezhurui
 * @Date: 2022/3/20 - 21:09
 * @Package: SEECII-ERP
 */

@Configuration
public class CORSConfig {

    private static final String[] originsVal =
            new String[]{
                    "localhost:8000",
                    "127.0.0.1:8000",
                    "127.0.0.1:8080",
                    "127.0.0.1",
            };

    /*private static final List<String> devVal = new ArrayList<>();

    static {
        //开发测试，把NAT之后的地址
        String s = "211.162.81.";
        for (int i = 1; i <= 254; i++) {
            devVal.add(s + i);
        }
    }*/

    /*private static String[] devVal =

            new String[]{
                    "211.162.81.1",
                    "211.162.81.2",
                    "211.162.81.3",
                    "211.162.81.4",
                    "211.162.81.5",
                    "211.162.81.6",
                    "211.162.81.7",
                    "211.162.81.8",
                    "211.162.81.9",
                    "211.162.81.10",
                    "211.162.81.11",
                    "211.162.81.12",
                    "211.162.81.13",
                    "211.162.81.14",
                    "211.162.81.15",
                    "211.162.81.16",
                    "211.162.81.17",
                    "211.162.81.18",
                    "211.162.81.19",
                    "211.162.81.20",
                    "211.162.81.21",
                    "211.162.81.22",
                    "211.162.81.23",
                    "211.162.81.24",
                    "211.162.81.25",
                    "211.162.81.26",
                    "211.162.81.27",
                    "211.162.81.28",
                    "211.162.81.29",
                    "211.162.81.30",
                    "211.162.81.31",
                    "211.162.81.32",
                    "211.162.81.33",
                    "211.162.81.34",
                    "211.162.81.35",
                    "211.162.81.36",
                    "211.162.81.37",
                    "211.162.81.38",
                    "211.162.81.39",
                    "211.162.81.40",
                    "211.162.81.41",
                    "211.162.81.42",
                    "211.162.81.43",
                    "211.162.81.44",
                    "211.162.81.45",
                    "211.162.81.46",
                    "211.162.81.47",
                    "211.162.81.48",
                    "211.162.81.49",
                    "211.162.81.50",
                    "211.162.81.51",
                    "211.162.81.52",
                    "211.162.81.53",
                    "211.162.81.54",
                    "211.162.81.55",
                    "211.162.81.56",
                    "211.162.81.57",
                    "211.162.81.58",
                    "211.162.81.59",
                    "211.162.81.60",
                    "211.162.81.61",
                    "211.162.81.62",
                    "211.162.81.63",
                    "211.162.81.64",
                    "211.162.81.65",
                    "211.162.81.66",
                    "211.162.81.67",
                    "211.162.81.68",
                    "211.162.81.69",
                    "211.162.81.70",
                    "211.162.81.71",
                    "211.162.81.72",
                    "211.162.81.73",
                    "211.162.81.74",
                    "211.162.81.75",
                    "211.162.81.76",
                    "211.162.81.77",
                    "211.162.81.78",
                    "211.162.81.79",
                    "211.162.81.80",
                    "211.162.81.81",
                    "211.162.81.82",
                    "211.162.81.83",
                    "211.162.81.84",
                    "211.162.81.85",
                    "211.162.81.86",
                    "211.162.81.87",
                    "211.162.81.88",
                    "211.162.81.89",
                    "211.162.81.90",
                    "211.162.81.91",
                    "211.162.81.92",
                    "211.162.81.93",
                    "211.162.81.94",
                    "211.162.81.95",
                    "211.162.81.96",
                    "211.162.81.97",
                    "211.162.81.98",
                    "211.162.81.99",
                    "211.162.81.100",
                    "211.162.81.101",
                    "211.162.81.102",
                    "211.162.81.103",
                    "211.162.81.104",
                    "211.162.81.105",
                    "211.162.81.106",
                    "211.162.81.107",
                    "211.162.81.108",
                    "211.162.81.109",
                    "211.162.81.110",
                    "211.162.81.111",
                    "211.162.81.112",
                    "211.162.81.113",
                    "211.162.81.114",
                    "211.162.81.115",
                    "211.162.81.116",
                    "211.162.81.117",
                    "211.162.81.118",
                    "211.162.81.119",
                    "211.162.81.120",
                    "211.162.81.121",
                    "211.162.81.122",
                    "211.162.81.123",
                    "211.162.81.124",
                    "211.162.81.125",
                    "211.162.81.126",
                    "211.162.81.127",
                    "211.162.81.128",
                    "211.162.81.129",
                    "211.162.81.130",
                    "211.162.81.131",
                    "211.162.81.132",
                    "211.162.81.133",
                    "211.162.81.134",
                    "211.162.81.135",
                    "211.162.81.136",
                    "211.162.81.137",
                    "211.162.81.138",
                    "211.162.81.139",
                    "211.162.81.140",
                    "211.162.81.141",
                    "211.162.81.142",
                    "211.162.81.143",
                    "211.162.81.144",
                    "211.162.81.145",
                    "211.162.81.146",
                    "211.162.81.147",
                    "211.162.81.148",
                    "211.162.81.149",
                    "211.162.81.150",
                    "211.162.81.151",
                    "211.162.81.152",
                    "211.162.81.153",
                    "211.162.81.154",
                    "211.162.81.155",
                    "211.162.81.156",
                    "211.162.81.157",
                    "211.162.81.158",
                    "211.162.81.159",
                    "211.162.81.160",
                    "211.162.81.161",
                    "211.162.81.162",
                    "211.162.81.163",
                    "211.162.81.164",
                    "211.162.81.165",
                    "211.162.81.166",
                    "211.162.81.167",
                    "211.162.81.168",
                    "211.162.81.169",
                    "211.162.81.170",
                    "211.162.81.171",
                    "211.162.81.172",
                    "211.162.81.173",
                    "211.162.81.174",
                    "211.162.81.175",
                    "211.162.81.176",
                    "211.162.81.177",
                    "211.162.81.178",
                    "211.162.81.179",
                    "211.162.81.180",
                    "211.162.81.181",
                    "211.162.81.182",
                    "211.162.81.183",
                    "211.162.81.184",
                    "211.162.81.185",
                    "211.162.81.186",
                    "211.162.81.187",
                    "211.162.81.188",
                    "211.162.81.189",
                    "211.162.81.190",
                    "211.162.81.191",
                    "211.162.81.192",
                    "211.162.81.193",
                    "211.162.81.194",
                    "211.162.81.195",
                    "211.162.81.196",
                    "211.162.81.197",
                    "211.162.81.198",
                    "211.162.81.199",
                    "211.162.81.200",
                    "211.162.81.201",
                    "211.162.81.202",
                    "211.162.81.203",
                    "211.162.81.204",
                    "211.162.81.205",
                    "211.162.81.206",
                    "211.162.81.207",
                    "211.162.81.208",
                    "211.162.81.209",
                    "211.162.81.210",
                    "211.162.81.211",
                    "211.162.81.212",
                    "211.162.81.213",
                    "211.162.81.214",
                    "211.162.81.215",
                    "211.162.81.216",
                    "211.162.81.217",
                    "211.162.81.218",
                    "211.162.81.219",
                    "211.162.81.220",
                    "211.162.81.221",
                    "211.162.81.222",
                    "211.162.81.223",
                    "211.162.81.224",
                    "211.162.81.225",
                    "211.162.81.226",
                    "211.162.81.227",
                    "211.162.81.228",
                    "211.162.81.229",
                    "211.162.81.230",
                    "211.162.81.231",
                    "211.162.81.232",
                    "211.162.81.233",
                    "211.162.81.234",
                    "211.162.81.235",
                    "211.162.81.236",
                    "211.162.81.237",
                    "211.162.81.238",
                    "211.162.81.239",
                    "211.162.81.240",
                    "211.162.81.241",
                    "211.162.81.242",
                    "211.162.81.243",
                    "211.162.81.244",
                    "211.162.81.245",
                    "211.162.81.246",
                    "211.162.81.247",
                    "211.162.81.248",
                    "211.162.81.249",
                    "211.162.81.250",
                    "211.162.81.251",
                    "211.162.81.252",
                    "211.162.81.253",
                    "211.162.81.254",
            };*/

    @Bean
    public CorsFilter corsFilter() {
        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        CorsConfiguration corsConfiguration = new CorsConfiguration();
        //todo 这个要换回来
        //addAllowedOrigins(corsConfiguration);
        corsConfiguration.addAllowedOriginPattern("*");
        // 允许token放置于请求头
        corsConfiguration.addExposedHeader("token");
        // 2
        corsConfiguration.addAllowedHeader("*");
        // 3
        corsConfiguration.addAllowedMethod("*");
        // 跨域session共享
        corsConfiguration.setAllowCredentials(true);
        // 4
        source.registerCorsConfiguration("/**", corsConfiguration);
        return new CorsFilter(source);
    }

    private void addAllowedOrigins(CorsConfiguration corsConfiguration) {
        for (String origin : originsVal) {
            corsConfiguration.addAllowedOrigin("http://" + origin);
            corsConfiguration.addAllowedOrigin("https://" + origin);
        }

       /* for (String origin : devVal) {
            corsConfiguration.addAllowedOrigin("http://" + origin);
            corsConfiguration.addAllowedOrigin("https://" + origin);
        }*/
    }
}
